# Lean-Agentic Architecture Diagrams

## System Overview (C4 Model - Context)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Lean-Agentic System                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Theorem      â”‚         â”‚   AI-Assisted  â”‚                 â”‚
â”‚  â”‚   Prover       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Proof Search â”‚                 â”‚
â”‚  â”‚                â”‚         â”‚                â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                         â”‚                           â”‚
â”‚           â”‚                         â”‚                           â”‚
â”‚           â–¼                         â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Hash-Consing   â”‚         â”‚   AgentDB      â”‚                 â”‚
â”‚  â”‚ Arena (150x)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Memory       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                         â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ WASM Browser â”‚          â”‚ Meta LLM     â”‚
    â”‚ (<100ms)     â”‚          â”‚ Compiler     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Users:
  - Mathematicians (proving theorems)
  - Developers (verified code)
  - Researchers (AI verification)
```

## Container Diagram - Core Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Lean-Agentic Platform                            â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   leanr-syntax   â”‚â”€â”€parse ASTâ”€â”€â–¶â”‚   leanr-elab     â”‚               â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚               â”‚
â”‚  â”‚  - Lexer         â”‚              â”‚  - Elaborator    â”‚               â”‚
â”‚  â”‚  - Parser        â”‚              â”‚  - Metavars      â”‚               â”‚
â”‚  â”‚  - Surface AST   â”‚              â”‚  - Unification   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  - Tactics âœ¨NEW â”‚               â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                              â”‚                         â”‚
â”‚                                              â”‚ Core Terms              â”‚
â”‚                                              â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              lean-agentic Core (Trusted Kernel)              â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Arena      â”‚â—„â”€â”€â”€â”¤ TypeChecker  â”‚â—„â”€â”€â”€â”¤ Environment  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Hash-Consing â”‚    â”‚ - infer()    â”‚    â”‚ Declarations â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ O(1) equalityâ”‚    â”‚ - check()    â”‚    â”‚ Inductivesâœ¨  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ - whnf()     â”‚    â”‚ Quotients âœ¨ â”‚  â”‚    â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Conversion   â”‚    â”‚ Level Arena  â”‚    â”‚ Symbol Table â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ - WHNF       â”‚    â”‚ Universe     â”‚    â”‚ String Internâ”‚  â”‚    â”‚
â”‚  â”‚  â”‚ - Beta/Delta â”‚    â”‚ Arithmetic   â”‚    â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚                         â”‚
â”‚                                              â”‚                         â”‚
â”‚                                              â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             leanr-eval-lite (Normalization)                  â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Normalizer  â”‚â”€â”€â”€â”€â”¤ Cache (150x) â”‚â”€â”€â”€â”€â”¤  Statistics  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ WHNF + Fuel  â”‚    â”‚ HashMap      â”‚    â”‚ Hit Rate     â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Integration Layer (NEW)                          â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Proof Cache  â”‚â—„â”€â”€â”€â”¤   AgentDB    â”‚â”€â”€â”€â”€â”¤ LLM Compiler â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ O(1) Lookup  â”‚    â”‚ Reasoning    â”‚    â”‚ Tactics      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Sub-linear   â”‚    â”‚ Bank         â”‚    â”‚ Suggestions  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Diagram - Tactic System (NEW)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               leanr-elab/src/tactic/                       â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Tactic Trait                            â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  trait Tactic {                                     â”‚ â”‚
â”‚  â”‚    fn apply(state, args) -> Vec<ProofGoal>         â”‚ â”‚
â”‚  â”‚    fn ai_hint(goal) -> Option<String>              â”‚ â”‚
â”‚  â”‚  }                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â–³                                  â”‚
â”‚                         â”‚ implements                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚         â”‚               â”‚               â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Basic    â”‚  â”‚  Rewrite   â”‚  â”‚ Induction  â”‚          â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚          â”‚
â”‚  â”‚ - intro    â”‚  â”‚ - rw       â”‚  â”‚ - inductionâ”‚          â”‚
â”‚  â”‚ - apply    â”‚  â”‚ - simp     â”‚  â”‚ - cases    â”‚          â”‚
â”‚  â”‚ - exact    â”‚  â”‚ - subst    â”‚  â”‚ - split    â”‚          â”‚
â”‚  â”‚ - refl     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                  â”‚
â”‚         â”‚ uses                                             â”‚
â”‚         â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           ProofState                                 â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  - goals: Vec<ProofGoal>                            â”‚ â”‚
â”‚  â”‚  - hypotheses: Vec<(SymbolId, TermId)>              â”‚ â”‚
â”‚  â”‚  - current_goal: usize                              â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  struct ProofGoal {                                 â”‚ â”‚
â”‚  â”‚    term: TermId,                                    â”‚ â”‚
â”‚  â”‚    context: Context,                                â”‚ â”‚
â”‚  â”‚    mvar_id: MetaVarId                               â”‚ â”‚
â”‚  â”‚  }                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                  â”‚
â”‚         â”‚ executes                                         â”‚
â”‚         â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         TacticExecutor                               â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  pub fn run_tactics(                                â”‚ â”‚
â”‚  â”‚    tactics: Vec<Tactic>,                            â”‚ â”‚
â”‚  â”‚    state: &mut ProofState                           â”‚ â”‚
â”‚  â”‚  ) -> Result<TermId>                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow - Theorem Proving Pipeline

```
User Input (Lean Syntax)
       â”‚
       â”‚ "theorem add_comm (a b : Nat) : a + b = b + a := by induction a"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  leanr-syntax    â”‚
â”‚  Parser          â”‚  Parse surface syntax â†’ AST
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ TheoremDecl { name, params, type, proof: TacticProof([...]) }
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  leanr-elab      â”‚
â”‚  Elaborator      â”‚  Elaborate AST â†’ Core Terms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Is proof a tactic block?
         â”‚ Yes â†’ Create ProofState
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TacticElaborator        â”‚
â”‚                          â”‚
â”‚  1. Initialize state     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     - goal: a+b=b+a      â”‚            â”‚
â”‚     - hypotheses: [a,b]  â”‚            â”‚
â”‚                          â”‚            â”‚
â”‚  2. Execute tactics:     â”‚            â”‚
â”‚     - induction a        â”‚            â”‚
â”‚                          â”‚            â”‚
â”‚  3. Generate subgoals:   â”‚            â”‚
â”‚     - base: 0+b=b+0      â”‚            â”‚
â”‚     - step: S(n)+b=b+S(n)â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
         â”‚                              â”‚ Check cache
         â”‚ For each subgoal:            â”‚
         â”‚                              â–¼
         â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚  Proof Cache   â”‚
         â”‚                     â”‚                â”‚
         â”‚                     â”‚  O(1) lookup   â”‚
         â”‚                     â”‚  via hash      â”‚
         â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚ Cache miss â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                              â”‚         â”‚
         â”‚                      Cache hit         â”‚
         â”‚                              â”‚         â”‚
         â”‚                              â–¼         â”‚
         â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚                     â”‚ Return cached  â”‚ â”‚
         â”‚                     â”‚ proof term     â”‚ â”‚
         â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚                                        â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Constructed proof term
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TypeChecker     â”‚  Verify proof term type-checks
â”‚  (Trusted)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ proof_term : (a + b = b + a)
         â”‚
         â”‚ Type checks? âœ“
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Environment     â”‚  Add theorem to global environment
â”‚                  â”‚
â”‚  add_constant(   â”‚
â”‚    "add_comm",   â”‚
â”‚    type,         â”‚
â”‚    proof_term    â”‚
â”‚  )               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    âœ… Success!
    Theorem proven and added
```

## Performance Architecture - Hash-Consing Flow

```
                    Term Construction
                          â”‚
                          â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  arena.mk_app(f,x) â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ 1. Compute hash
                          â”‚    H(App, H(f), H(x))
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Hash Table Lookup  â”‚
              â”‚   O(1) average case  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                â”‚
            Found â”‚                â”‚ Not Found
                 â”‚                â”‚
                 â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Return         â”‚  â”‚ Allocate       â”‚
        â”‚ existing ID    â”‚  â”‚ new term       â”‚
        â”‚                â”‚  â”‚ in arena       â”‚
        â”‚ O(1)           â”‚  â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ O(1) bump      â”‚
                            â”‚ allocation     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ Insert into
                                     â”‚ hash table
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Return new ID  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: All structurally equal terms share same ID
        â†’ Equality check is pointer comparison
        â†’ 150x speedup for large proofs
```

## Incremental Verification Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Proof Library (Content-Addressed)              â”‚
â”‚                                                             â”‚
â”‚  File: stdlib/nat.lean                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ theorem add_comm ... := ...                         â”‚   â”‚
â”‚  â”‚ theorem mul_comm ... := ...                         â”‚   â”‚
â”‚  â”‚ theorem add_assoc ... := ...                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚                          â”‚ Compile                          â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Content Hash Map                            â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  hash(add_comm) â†’ {                                â”‚   â”‚
â”‚  â”‚    proof_term: TermId(42),                         â”‚   â”‚
â”‚  â”‚    deps: [hash(Nat), hash(add)],                   â”‚   â”‚
â”‚  â”‚    verified: true,                                 â”‚   â”‚
â”‚  â”‚    timestamp: 2025-10-25T10:00:00Z                 â”‚   â”‚
â”‚  â”‚  }                                                  â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  hash(mul_comm) â†’ { ... }                          â”‚   â”‚
â”‚  â”‚  hash(add_assoc) â†’ { ... }                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚                          â”‚ On rebuild                       â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Incremental Verification                       â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  For each theorem:                                 â”‚   â”‚
â”‚  â”‚    1. Compute content hash                         â”‚   â”‚
â”‚  â”‚    2. Check if hash exists in cache                â”‚   â”‚
â”‚  â”‚    3. If exists AND deps unchanged:                â”‚   â”‚
â”‚  â”‚         âœ… Skip verification                        â”‚   â”‚
â”‚  â”‚    4. Else:                                        â”‚   â”‚
â”‚  â”‚         ğŸ” Re-verify with kernel                   â”‚   â”‚
â”‚  â”‚         ğŸ’¾ Update cache                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Result: Only changed theorems are re-verified             â”‚
â”‚  Speedup: 10-100x for library builds                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## AI-Assisted Proof Search Architecture

```
                    Theorem Goal
                         â”‚
                         â”‚ "âˆ€x, x + 0 = x"
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Check Proof Cache          â”‚
        â”‚     (O(1) lookup)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
    Found â”‚                â”‚ Not Found
         â”‚                â”‚
         â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Return   â”‚    â”‚  Query AgentDB           â”‚
   â”‚ cached   â”‚    â”‚                          â”‚
   â”‚ proof    â”‚    â”‚  Search similar proofs:  â”‚
   â”‚          â”‚    â”‚  - x + 0 = x             â”‚
   â”‚ <1ms     â”‚    â”‚  - a + 0 = a             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  - n + zero = n          â”‚
                   â”‚                          â”‚
                   â”‚  Extract tactics used:   â”‚
                   â”‚  - intro                 â”‚
                   â”‚  - induction             â”‚
                   â”‚  - rewrite add_zero      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Call LLM Compiler
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Meta LLM Compiler API  â”‚
                   â”‚                         â”‚
                   â”‚  "Given x+0=x, suggest  â”‚
                   â”‚   tactics..."           â”‚
                   â”‚                         â”‚
                   â”‚  Response:              â”‚
                   â”‚  1. intro x             â”‚
                   â”‚  2. induction x         â”‚
                   â”‚  3. rewrite add_zero    â”‚
                   â”‚  4. reflexivity         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Ranked tactics
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Tactic Executor       â”‚
                   â”‚                         â”‚
                   â”‚   Try tactics in order: â”‚
                   â”‚   1. intro âœ“            â”‚
                   â”‚   2. induction âœ“        â”‚
                   â”‚      - base case âœ“      â”‚
                   â”‚      - inductive case âœ“ â”‚
                   â”‚   3. reflexivity âœ“      â”‚
                   â”‚                         â”‚
                   â”‚   Success! Proof found  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Store in cache
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Update Caches          â”‚
                   â”‚                         â”‚
                   â”‚  1. Proof Cache âœ“       â”‚
                   â”‚  2. AgentDB Episode âœ“   â”‚
                   â”‚     - Success           â”‚
                   â”‚     - Reward: 1.0       â”‚
                   â”‚     - Tactics used      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                     âœ… Proof Complete
                     Future queries: <1ms
```

## WASM Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Browser Environment                         â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             index.html                                   â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  <script src="lean-agentic.js"></script>                â”‚ â”‚
â”‚  â”‚  <script>                                               â”‚ â”‚
â”‚  â”‚    const prover = await wasm_bindgen("lean-agentic.wasm");â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚    // Prove theorem in browser!                        â”‚ â”‚
â”‚  â”‚    const result = prover.prove(                        â”‚ â”‚
â”‚  â”‚      "theorem add_comm : âˆ€ a b, a + b = b + a"         â”‚ â”‚
â”‚  â”‚    );                                                   â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚    console.log("Proof:", result.proof_term);           â”‚ â”‚
â”‚  â”‚    console.log("Time:", result.latency_ms, "ms");      â”‚ â”‚
â”‚  â”‚  </script>                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                   â”‚
â”‚                            â”‚ Loads WASM                        â”‚
â”‚                            â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        lean-agentic.wasm (64KB compressed)               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚   WebAssembly Module                            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   Core:                                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Arena (hash-consing)                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - TypeChecker (trusted kernel)                â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Normalizer (with cache)                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   Elaboration:                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Parser (Lean syntax)                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Elaborator (bidirectional)                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Basic tactics (5-10 most common)            â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   Optimizations:                                â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - wee_alloc (small allocator)                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - LTO + opt-level=z                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚   - Tree shaking (remove unused)                â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Performance:                                           â”‚ â”‚
â”‚  â”‚  - Load time: <100ms                                    â”‚ â”‚
â”‚  â”‚  - Proof latency: <10ms P99                             â”‚ â”‚
â”‚  â”‚  - Memory: <10MB                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                   â”‚
â”‚                            â”‚ Optional: IndexedDB cache         â”‚
â”‚                            â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Browser Storage (Persistent)                     â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  - Proof cache (100MB)                                  â”‚ â”‚
â”‚  â”‚  - Standard library theorems                            â”‚ â”‚
â”‚  â”‚  - User session state                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Build Command:
  cargo build --target wasm32-unknown-unknown --release
  wasm-pack build --target web --release -- \
    -C opt-level=z -C lto=fat
  wasm-opt -Oz -o output.wasm input.wasm

Result: 64KB gzipped WASM module
```

## Theorem Library Organization

```
lean-agentic/library/
â”‚
â”œâ”€â”€ Init/                       # Core definitions
â”‚   â”œâ”€â”€ Prelude.lean           # Basic types (Nat, Bool, etc.)
â”‚   â”œâ”€â”€ Logic.lean             # Propositional logic
â”‚   â””â”€â”€ Tactics.lean           # Tactic imports
â”‚
â”œâ”€â”€ Data/                       # Data structures
â”‚   â”œâ”€â”€ Nat/
â”‚   â”‚   â”œâ”€â”€ Basic.lean         # Nat definition
â”‚   â”‚   â”œâ”€â”€ Add.lean           # Addition properties (30+ theorems)
â”‚   â”‚   â”œâ”€â”€ Mul.lean           # Multiplication (40+ theorems)
â”‚   â”‚   â””â”€â”€ Induction.lean     # Induction principle
â”‚   â”‚
â”‚   â”œâ”€â”€ Int/
â”‚   â”‚   â”œâ”€â”€ Basic.lean         # Int as quotient
â”‚   â”‚   â”œâ”€â”€ Add.lean           # Integer addition
â”‚   â”‚   â””â”€â”€ Order.lean         # Ordering
â”‚   â”‚
â”‚   â””â”€â”€ Real/
â”‚       â”œâ”€â”€ Basic.lean         # Real as Cauchy sequences
â”‚       â”œâ”€â”€ Limit.lean         # Limits (100+ theorems)
â”‚       â””â”€â”€ Continuous.lean    # Continuity
â”‚
â”œâ”€â”€ Algebra/                    # Abstract algebra
â”‚   â”œâ”€â”€ Group/
â”‚   â”‚   â”œâ”€â”€ Basic.lean         # Group axioms
â”‚   â”‚   â”œâ”€â”€ Subgroup.lean      # Subgroup theory
â”‚   â”‚   â””â”€â”€ Homomorphism.lean  # Group homomorphisms
â”‚   â”‚
â”‚   â”œâ”€â”€ Ring/
â”‚   â”‚   â”œâ”€â”€ Basic.lean         # Ring axioms
â”‚   â”‚   â””â”€â”€ Ideal.lean         # Ideals
â”‚   â”‚
â”‚   â””â”€â”€ Field/
â”‚       â””â”€â”€ Basic.lean         # Field axioms
â”‚
â”œâ”€â”€ Analysis/                   # Real analysis
â”‚   â”œâ”€â”€ Limit.lean             # Limit theory
â”‚   â”œâ”€â”€ Continuous.lean        # Continuity
â”‚   â”œâ”€â”€ Derivative.lean        # Derivatives
â”‚   â””â”€â”€ Integral.lean          # Integration
â”‚
â””â”€â”€ CategoryTheory/             # Category theory
    â”œâ”€â”€ Category.lean          # Category definition
    â”œâ”€â”€ Functor.lean           # Functors
    â””â”€â”€ NaturalTransformation.lean

Metrics:
  - Phase 1: 100+ theorems (Nat)
  - Phase 2: 500+ theorems (Algebra)
  - Phase 3: 1000+ theorems (Analysis)
  - Phase 4: 2000+ theorems (Full library)
```

## Deployment Scenarios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Deployment Options                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Browser (WASM)
   â”œâ”€ Use Case: Interactive learning, demos
   â”œâ”€ Target: lean-agentic.wasm (64KB)
   â”œâ”€ Performance: <10ms proof latency
   â””â”€ Example: examples/wasm-demo/theorem_prover.html

2. Native (Rust)
   â”œâ”€ Use Case: Large libraries, CI/CD
   â”œâ”€ Target: lean-agentic binary
   â”œâ”€ Performance: <1ms proof latency
   â””â”€ Example: cargo run --example 06_peano_arithmetic

3. VS Code Extension (LSP)
   â”œâ”€ Use Case: IDE integration
   â”œâ”€ Target: lean-agentic-lsp server
   â”œâ”€ Performance: Real-time feedback
   â””â”€ Features: Autocomplete, error checking, proof tactics

4. Cloud (API)
   â”œâ”€ Use Case: Distributed proving, AI integration
   â”œâ”€ Target: REST API with rate limiting
   â”œâ”€ Performance: <100ms end-to-end
   â””â”€ Features: Proof cache sharing, LLM integration

5. Embedded (no_std)
   â”œâ”€ Use Case: IoT, embedded verification
   â”œâ”€ Target: ARM Cortex-M4+ (no allocator)
   â”œâ”€ Performance: <10ms with limits
   â””â”€ Features: Minimal kernel only
```

---

## Legend

```
Symbols:
  â”€â”€â–¶  Data flow
  â—„â”€â”€  Bidirectional
  â”Œâ”€â”  Component/container
  âœ…   Completed/verified
  âš ï¸   In progress
  âœ¨   New feature
  ğŸ”   Verification step
  ğŸ’¾   Storage/caching
  âš¡   Performance critical
```

## Notes

1. All diagrams use **C4 model** conventions for consistency
2. Performance numbers are **targets** based on current benchmarks
3. **Hash-consing** is the foundation - all optimizations leverage it
4. **Trusted kernel** is isolated - tactics and elaboration are untrusted
5. **WASM** deployment is first-class - not an afterthought

---

**Status**: âœ… Architecture diagrams complete
**Next**: Implementation of Phase 1 (Inductive types + basic tactics)
